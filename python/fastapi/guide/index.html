<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>FastAPI - 用户指南 | 大可墨韵</title><meta name="author" content="大可"><meta name="copyright" content="大可"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="路径参数有类型的路径参数在这个例子中，item_id 被声明为 int 类型。 123@app.get(&quot;&#x2F;items&#x2F;&amp;#123;item_id&amp;#125;&quot;)async def read_item(item_id:int):    return &amp;#123;&quot;item_id&quot;: item_id&amp;#125;  你可以使用同样的类型声明来声明 str、flo">
<meta property="og:type" content="article">
<meta property="og:title" content="FastAPI - 用户指南">
<meta property="og:url" content="https://dak.wang/python/fastapi/guide/index.html">
<meta property="og:site_name" content="大可墨韵">
<meta property="og:description" content="路径参数有类型的路径参数在这个例子中，item_id 被声明为 int 类型。 123@app.get(&quot;&#x2F;items&#x2F;&amp;#123;item_id&amp;#125;&quot;)async def read_item(item_id:int):    return &amp;#123;&quot;item_id&quot;: item_id&amp;#125;  你可以使用同样的类型声明来声明 str、flo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dak.wang/python/fastapi/guide/cover.png">
<meta property="article:published_time" content="2023-08-10T06:30:17.000Z">
<meta property="article:modified_time" content="2023-08-27T08:19:48.579Z">
<meta property="article:author" content="大可">
<meta property="article:tag" content="学习之旅">
<meta property="article:tag" content="Python框架">
<meta property="article:tag" content="API接口开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dak.wang/python/fastapi/guide/cover.png"><link rel="shortcut icon" href="/assets/imgs/dak_icon.png"><link rel="canonical" href="https://dak.wang/python/fastapi/guide/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 大可","link":"链接: ","source":"来源: 大可墨韵","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'FastAPI - 用户指南',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-08-27 16:19:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/assets/css/github-dark.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/imgs/dak_avatar_120.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-archive"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/python/fastapi/guide/cover.png')"><nav id="nav"><span id="blog-info"><a href="/" title="大可墨韵"><span class="site-name">大可墨韵</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-archive"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">FastAPI - 用户指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-10T06:30:17.000Z" title="发表于 2023-08-10 14:30:17">2023-08-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-27T08:19:48.579Z" title="更新于 2023-08-27 16:19:48">2023-08-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/FastAPI/">FastAPI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="FastAPI - 用户指南"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h1><h2 id="有类型的路径参数"><a href="#有类型的路径参数" class="headerlink" title="有类型的路径参数"></a>有类型的路径参数</h2><p>在这个例子中，item_id 被声明为 int 类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id:<span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>你可以使用同样的类型声明来声明 str、float、bool 以及许多其他的复合数据类型<br>所有的数据校验都由 Pydantic 在幕后完成</p>
</blockquote>
<h2 id="顺序很重要"><a href="#顺序很重要" class="headerlink" title="顺序很重要"></a>顺序很重要</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/me&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user_me</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-string">&quot;the current user&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: user_id&#125;<br></code></pre></td></tr></table></figure>
<p>由于路径操作是按顺序依次运行的，你需要确保路径 <code>/users/me</code> 声明在路径 <code>/users/&#123;user_id&#125;</code>之前<br>否则，<code>/users/&#123;user_id&#125;</code>的路径还将与 <code>/users/me</code> 相匹配，”认为”自己正在接收一个值为 “me” 的 <code>user_id</code> 参数。</p>
<h2 id="预设值"><a href="#预设值" class="headerlink" title="预设值"></a>预设值</h2><p>如果你有一个接收路径参数的路径操作，但你希望<strong>预先设定可能的有效参数值</strong>，则可以使用标准的 Python Enum 类型。</p>
<h3 id="创建一个-Enum-类"><a href="#创建一个-Enum-类" class="headerlink" title="创建一个 Enum 类"></a>创建一个 Enum 类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelName</span>(<span class="hljs-built_in">str</span>, Enum):<br>    alexnet = <span class="hljs-string">&quot;alexnet&quot;</span><br>    resnet = <span class="hljs-string">&quot;resnet&quot;</span><br>    lenet = <span class="hljs-string">&quot;lenet&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="声明路径参数"><a href="#声明路径参数" class="headerlink" title="声明路径参数"></a>声明路径参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/models/&#123;model_name&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_model</span>(<span class="hljs-params">model_name: ModelName</span>):<br>    <span class="hljs-keyword">if</span> model_name <span class="hljs-keyword">is</span> ModelName.alexnet:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;model_name&quot;</span>: model_name, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Deep Learning FTW!&quot;</span>&#125;<br><br>    <span class="hljs-keyword">if</span> model_name.value == <span class="hljs-string">&quot;lenet&quot;</span>:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;model_name&quot;</span>: model_name, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;LeCNN all the images&quot;</span>&#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;model_name&quot;</span>: model_name, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Have some residuals&quot;</span>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="包含路径的路径参数"><a href="#包含路径的路径参数" class="headerlink" title="包含路径的路径参数"></a>包含路径的路径参数</h2><p>假设你有一个路径操作，它的路径为 <code>/files/&#123;file_path&#125;</code><br>但是你需要 <code>file_path</code> 自身也包含路径，比如 <code>home/johndoe/myfile.txt</code><br>因此，该文件的URL将类似于这样：<code>/files/home/johndoe/myfile.txt</code></p>
<p>你可以使用直接来自 Starlette 的选项来声明一个包含路径的路径参数：<br>而且文档依旧可以使用，但是不会添加任何该参数应包含路径的说明。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/files/&#123;file_path:path&#125;<br></code></pre></td></tr></table></figure>
<p>在这种情况下，参数的名称为 file_path，结尾部分的 :path 说明该参数应匹配任意的路径。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;file_path&quot;</span>: file_path&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>你可能会需要参数包含 &#x2F;home&#x2F;johndoe&#x2F;myfile.txt，以斜杠（&#x2F;）开头。<br>在这种情况下，URL 将会是 &#x2F;files&#x2F;&#x2F;home&#x2F;johndoe&#x2F;myfile.txt，在files 和 home 之间有一个双斜杠（&#x2F;&#x2F;）。</p>
</blockquote>
<h1 id="查询参数"><a href="#查询参数" class="headerlink" title="查询参数"></a>查询参数</h1><p>声明不属于路径参数的其他函数参数时，它们将被自动解释为”查询字符串”参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">skip: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>, limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    <span class="hljs-keyword">return</span> fake_items_db[skip : skip + limit]<br></code></pre></td></tr></table></figure>
<p>例如：<code>http://127.0.0.1:8000/items/?skip=0&amp;limit=10</code><br>查询参数为:</p>
<ul>
<li>skip : 0</li>
<li>limit : 10</li>
</ul>
<p>由于它们是 URL 的一部分，因此它们的”原始值”是字符串。<br>但是，当你为它们声明了 Python 类型（在上面的示例中为 int）时，它们将转换为该类型并针对该类型进行校验。</p>
<h2 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h2><p>在上面的示例中，它们具有 skip&#x3D;0 和 limit&#x3D;10 的默认值。</p>
<h2 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h2><p>通过同样的方式，你可以将它们的默认值设置为 None 来声明可选查询参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span>, q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> q:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;q&quot;</span>: q&#125;<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br></code></pre></td></tr></table></figure>
<p>在这个例子中，函数参数 q 将是可选的，并且默认值为 None。</p>
<h2 id="查询参数类型转换"><a href="#查询参数类型转换" class="headerlink" title="查询参数类型转换"></a>查询参数类型转换</h2><p>你还可以声明 bool 类型，它们将被自动转换：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span>, q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span>, short: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):<br>    item = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        item.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> short:<br>        item.update(<br>            &#123;<span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;This is an amazing item that has a long description&quot;</span>&#125;<br>        )<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure>
<p>这个例子中，如果你访问：<br><code>http://127.0.0.1:8000/items/foo?short=1</code><br>或<br><code>http://127.0.0.1:8000/items/foo?short=True</code><br>或<br><code>http://127.0.0.1:8000/items/foo?short=true</code><br>或<br><code>http://127.0.0.1:8000/items/foo?short=on</code><br>或<br><code>http://127.0.0.1:8000/items/foo?short=yes</code></p>
<p>或任何其他的变体形式（大写，首字母大写等等），你的函数接收的 short 参数都会是布尔值 True。对于值为 False 的情况也是一样的。</p>
<h2 id="多个路径和查询参数"><a href="#多个路径和查询参数" class="headerlink" title="多个路径和查询参数"></a>多个路径和查询参数</h2><p>你可以同时声明多个路径参数和查询参数，FastAPI 能够识别它们。<br>而且你不需要以任何特定的顺序来声明。<br>它们将通过名称被检测到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/&#123;user_id&#125;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user_item</span>(<span class="hljs-params"></span><br><span class="hljs-params">    user_id: <span class="hljs-built_in">int</span>, item_id: <span class="hljs-built_in">str</span>, q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span>, short: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span><br><span class="hljs-params"></span>):<br>    item = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;owner_id&quot;</span>: user_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        item.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> short:<br>        item.update(<br>            &#123;<span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;This is an amazing item that has a long description&quot;</span>&#125;<br>        )<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure>

<h2 id="必需查询参数"><a href="#必需查询参数" class="headerlink" title="必需查询参数"></a>必需查询参数</h2><p>当你为非路径参数声明了默认值时（目前而言，我们所知道的仅有查询参数），则该参数不是必需的。<br>如果你不想添加一个特定的值，而只是想使该参数成为可选的，则将默认值设置为 None。<br>但当你想让一个查询参数成为必需的，不声明任何默认值就可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span>, needy: <span class="hljs-built_in">str</span></span>):<br>    item = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;needy&quot;</span>: needy&#125;<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure>
<p>这里的查询参数 needy 是类型为 str 的必需查询参数。</p>
<p>当然，你也可以定义一些参数为必需的，一些具有默认值，而某些则完全是可选的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user_item</span>(<span class="hljs-params"></span><br><span class="hljs-params">    item_id: <span class="hljs-built_in">str</span>, needy: <span class="hljs-built_in">str</span>, skip: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>, limit: <span class="hljs-type">Union</span>[<span class="hljs-built_in">int</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span></span><br><span class="hljs-params"></span>):<br>    item = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;needy&quot;</span>: needy, <span class="hljs-string">&quot;skip&quot;</span>: skip, <span class="hljs-string">&quot;limit&quot;</span>: limit&#125;<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure>
<p>在这个例子中，有3个查询参数：</p>
<ul>
<li>needy，一个必需的 str 类型参数。</li>
<li>skip，一个默认值为 0 的 int 类型参数。</li>
<li>limit，一个可选的 int 类型参数。</li>
</ul>
<h1 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h1><p>我们使用 <code>Pydantic</code> 模型来声明请求体，并能够获得它们所具有的所有能力和优点。</p>
<h2 id="导入-Pydantic-的-BaseModel"><a href="#导入-Pydantic-的-BaseModel" class="headerlink" title="导入 Pydantic 的 BaseModel"></a>导入 Pydantic 的 BaseModel</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br></code></pre></td></tr></table></figure>

<h2 id="创建数据模型"><a href="#创建数据模型" class="headerlink" title="创建数据模型"></a>创建数据模型</h2><p>然后，将你的数据模型声明为继承自 BaseModel 的类。<br>使用标准的 Python 类型来声明所有属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure>
<p>和声明查询参数时一样，当一个模型属性具有默认值时，它不是必需的。否则它是一个必需属性。将默认值设为 None 可使其成为可选属性。</p>
<h2 id="声明为参数"><a href="#声明为参数" class="headerlink" title="声明为参数"></a>声明为参数</h2><p>使用与声明路径和查询参数的相同方式声明请求体，即可将其添加到「路径操作」中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure>

<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>仅仅使用了 Python 类型声明，FastAPI 将会：</p>
<ul>
<li>将请求体作为 JSON 读取。</li>
<li>转换为相应的类型（在需要时）。</li>
<li>校验数据。</li>
<li>如果数据无效，将返回一条清晰易读的错误信息，指出不正确数据的确切位置和内容。</li>
<li>将接收的数据赋值到参数 item 中。</li>
<li>由于你已经在函数中将它声明为 Item 类型，你还将获得对于所有属性及其类型的一切编辑器支持（代码补全等）。</li>
<li>为你的模型生成 JSON 模式 定义，你还可以在其他任何对你的项目有意义的地方使用它们。</li>
<li>这些模式将成为生成的 OpenAPI 模式的一部分，并且被自动化文档 UI 所使用。</li>
</ul>
<h2 id="使用模型"><a href="#使用模型" class="headerlink" title="使用模型"></a>使用模型</h2><p>在函数内部，你可以直接访问模型对象的所有属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    item_dict = item.<span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">if</span> item.tax:<br>        price_with_tax = item.price + item.tax<br>        item_dict.update(&#123;<span class="hljs-string">&quot;price_with_tax&quot;</span>: price_with_tax&#125;)<br>    <span class="hljs-keyword">return</span> item_dict<br></code></pre></td></tr></table></figure>

<h2 id="请求体-路径参数"><a href="#请求体-路径参数" class="headerlink" title="请求体 + 路径参数"></a>请求体 + 路径参数</h2><p>你可以同时声明路径参数和请求体。<br>FastAPI 将识别出与路径参数匹配的函数参数应从路径中获取，而声明为 Pydantic 模型的函数参数应从请求体中获取。</p>
<h2 id="请求体-路径参数-查询参数"><a href="#请求体-路径参数-查询参数" class="headerlink" title="请求体 + 路径参数 + 查询参数"></a>请求体 + 路径参数 + 查询参数</h2><p>你还可以同时声明请求体、路径参数和查询参数。<br>FastAPI 会识别它们中的每一个，并从正确的位置获取数据。</p>
<p>函数参数将依次按如下规则进行识别：</p>
<ul>
<li>如果在路径中也声明了该参数，它将被用作路径参数。</li>
<li>如果参数属于单一类型（比如 int、float、str、bool 等）它将被解释为查询参数。</li>
<li>如果参数的类型被声明为一个 Pydantic 模型，它将被解释为请求体。</li>
</ul>
<h2 id="不使用-Pydantic"><a href="#不使用-Pydantic" class="headerlink" title="不使用 Pydantic"></a>不使用 Pydantic</h2><p>如果你不想使用 Pydantic 模型，你还可以使用 Body 参数。请参阅文档 <a target="_blank" rel="noopener" href="https://fastapi.tiangolo.com/zh/tutorial/body-multiple-params/#singular-values-in-body">请求体 - 多个参数：请求体中的单一值。</a></p>
<h1 id="查询参数和字符串校验"><a href="#查询参数和字符串校验" class="headerlink" title="查询参数和字符串校验"></a>查询参数和字符串校验</h1><p>FastAPI 允许你为参数声明额外的信息和校验。<br>让我们以下面的应用程序为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h2 id="额外的校验"><a href="#额外的校验" class="headerlink" title="额外的校验"></a>额外的校验</h2><p>我们打算添加约束条件：即使 q 是可选的，但只要提供了该参数，则该参数值不能超过50个字符的长度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=<span class="hljs-literal">None</span>, max_length=<span class="hljs-number">50</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>
<p> <code>Query</code> 显式地将<code>q</code>声明为查询参数。</p>
<h2 id="添加更多校验"><a href="#添加更多校验" class="headerlink" title="添加更多校验"></a>添加更多校验</h2><ul>
<li>min_length </li>
<li>pattern</li>
<li>…</li>
</ul>
<h2 id="默认值-1"><a href="#默认值-1" class="headerlink" title="默认值"></a>默认值</h2><p>你可以向 Query 的第一个参数传入 None 用作查询参数的默认值，以同样的方式你也可以传递其他默认值。<br>假设你想要声明查询参数 q，使其 min_length 为 3，并且默认值为 fixedquery：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span> = Query(<span class="hljs-params">default=<span class="hljs-string">&quot;fixedquery&quot;</span>, min_length=<span class="hljs-number">3</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h2 id="声明为必需参数"><a href="#声明为必需参数" class="headerlink" title="声明为必需参数"></a>声明为必需参数</h2><p>当我们不需要声明额外的校验或元数据时，只需不声明默认值就可以使 q 参数成为必需参数，例如：<br><code>q: str</code><br>当你在使用 Query 且需要声明一个值是必需的时，只需不声明默认参数：<br><code>q: str = Query(min_length=3)</code></p>
<h3 id="使用省略号-…-声明必需参数"><a href="#使用省略号-…-声明必需参数" class="headerlink" title="使用省略号(…)声明必需参数"></a>使用省略号(…)声明必需参数</h3><p>有另一种方法可以显式的声明一个值是必需的，即将默认参数的默认值设为 … ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span> = Query(<span class="hljs-params">default=..., min_length=<span class="hljs-number">3</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果你之前没见过 … 这种用法：它是一个特殊的单独值，它是 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/constants.html#Ellipsis">Python 的一部分并且被称为「省略号」</a>。<br> Pydantic 和 FastAPI 使用它来显式的声明需要一个值。</p>
</blockquote>
<p>这将使 FastAPI 知道此查询参数是必需的。</p>
<h3 id="使用None声明必需参数"><a href="#使用None声明必需参数" class="headerlink" title="使用None声明必需参数"></a>使用None声明必需参数</h3><p>你可以声明一个参数可以接收None值，但它仍然是必需的。这将强制客户端发送一个值，即使该值是None。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=..., min_length=<span class="hljs-number">3</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h3 id="使用Pydantic中的Required代替省略号-…"><a href="#使用Pydantic中的Required代替省略号-…" class="headerlink" title="使用Pydantic中的Required代替省略号(…)"></a>使用Pydantic中的Required代替省略号(…)</h3><p>如果你觉得使用 … 不舒服，你也可以从 Pydantic 导入并使用 Required：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> Required<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span> = Query(<span class="hljs-params">default=Required, min_length=<span class="hljs-number">3</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>
<div class="note warning flat"><p>请记住，在大多数情况下，当你需要某些东西时，可以简单地省略 default 参数，因此你通常不必使用 … 或 Required</p>
</div>

<h2 id="查询参数列表-多个值"><a href="#查询参数列表-多个值" class="headerlink" title="查询参数列表 &#x2F; 多个值"></a>查询参数列表 &#x2F; 多个值</h2><p>当你使用 Query 显式地定义查询参数时，你还可以声明它去接收一组值，或换句话来说，接收多个值。<br>例如，要声明一个可在 URL 中出现多次的查询参数 q，你可以这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">Union</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=<span class="hljs-literal">None</span></span>)</span>):<br>    query_items = &#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;<br>    <span class="hljs-keyword">return</span> query_items<br></code></pre></td></tr></table></figure>
<p>然后，输入如下网址：<br><code>http://localhost:8000/items/?q=foo&amp;q=bar</code><br>你会在路径操作函数的函数参数 q 中以一个 Python list 的形式接收到查询参数 q 的多个值（foo 和 bar）。<br>因此，该 URL 的响应将会是：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;q&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;foo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;bar&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>要声明类型为 list 的查询参数，如上例所示，你需要显式地使用 Query，否则该参数将被解释为请求体。</p>
</blockquote>
<h3 id="具有默认值的查询参数列表-多个值"><a href="#具有默认值的查询参数列表-多个值" class="headerlink" title="具有默认值的查询参数列表 &#x2F; 多个值"></a>具有默认值的查询参数列表 &#x2F; 多个值</h3><p>你还可以定义在没有任何给定值时的默认 list 值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = Query(<span class="hljs-params">default=[<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;bar&quot;</span>]</span>)</span>):<br>    query_items = &#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;<br>    <span class="hljs-keyword">return</span> query_items<br></code></pre></td></tr></table></figure>

<h4 id="使用-list"><a href="#使用-list" class="headerlink" title="使用 list"></a>使用 list</h4><p>你也可以直接使用 list 代替 List [str]：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-built_in">list</span> = Query(<span class="hljs-params">default=[]</span>)</span>):<br>    query_items = &#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;<br>    <span class="hljs-keyword">return</span> query_items<br></code></pre></td></tr></table></figure>
<div class="note warning flat"><p>请记住，在这种情况下 FastAPI 将不会检查列表的内容。<br>例如，List[int] 将检查（并记录到文档）列表的内容必须是整数。但是单独的 list 不会。</p>
</div>

<h2 id="声明更多元数据"><a href="#声明更多元数据" class="headerlink" title="声明更多元数据"></a>声明更多元数据</h2><p>你可以添加更多有关该参数的信息。<br>这些信息将包含在生成的 OpenAPI 模式中，并由文档用户界面和外部工具所使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-params">        default=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">        title=<span class="hljs-string">&quot;Query string&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">        description=<span class="hljs-string">&quot;Query string for the items to search in the database that have a good match&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">        min_length=<span class="hljs-number">3</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">    </span>)</span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h2 id="别名参数"><a href="#别名参数" class="headerlink" title="别名参数"></a>别名参数</h2><p>假设你想要查询参数为 item-query。<br>像下面这样：<br><code>http://127.0.0.1:8000/items/?item-query=foobaritems</code></p>
<p>但是 item-query 不是一个有效的 Python 变量名称。<br>最接近的有效名称是 item_query。<br>但是你仍然要求它在 URL 中必须是 item-query…<br>这时你可以用 alias 参数声明一个别名，该别名将用于在 URL 中查找查询参数值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=<span class="hljs-literal">None</span>, alias=<span class="hljs-string">&quot;item-query&quot;</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h2 id="弃用参数"><a href="#弃用参数" class="headerlink" title="弃用参数"></a>弃用参数</h2><p>现在假设你不再喜欢此参数。<br>你不得不将其保留一段时间，因为有些客户端正在使用它，但你希望文档清楚地将其展示为已弃用。<br>那么将参数 deprecated&#x3D;True 传入 Query</p>
<h1 id="路径参数和数值校验"><a href="#路径参数和数值校验" class="headerlink" title="路径参数和数值校验"></a>路径参数和数值校验</h1><p>与使用 Query 为查询参数声明更多的校验和元数据的方式相同，你也可以使用 Path 为路径参数声明相同类型的校验和元数据。</p>
<h2 id="声明元数据"><a href="#声明元数据" class="headerlink" title="声明元数据"></a>声明元数据</h2><p>你可以声明与 Query 相同的所有参数。<br>例如，要声明路径参数 item_id的 title 元数据值，你可以输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Path, Query<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    item_id: Annotated[<span class="hljs-built_in">int</span>, Path(<span class="hljs-params">title=<span class="hljs-string">&quot;The ID of the item to get&quot;</span></span>)],</span><br><span class="hljs-params">    q: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Query(<span class="hljs-params">alias=<span class="hljs-string">&quot;item-query&quot;</span></span>)] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h2 id="按需对参数排序"><a href="#按需对参数排序" class="headerlink" title="按需对参数排序"></a>按需对参数排序</h2><p>如果你将带有「默认值」的参数放在没有「默认值」的参数之前，Python 将会报错。<br>但是你可以对其重新排序，并将不带默认值的值（查询参数 q）放到最前面。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span>, item_id: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">title=<span class="hljs-string">&quot;The ID of the item to get&quot;</span></span>)</span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<p>如果你想不使用 Query 声明没有默认值的查询参数 q，同时使用 Path 声明路径参数 item_id，并使它们的顺序与上面不同，Python 对此有一些特殊的语法。<br>传递 * 作为函数的第一个参数。<br>Python 不会对该 * 做任何事情，但是它将知道之后的所有参数都应作为关键字参数（键值对），也被称为 kwargs，来调用。即使它们没有默认值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">*, item_id: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">title=<span class="hljs-string">&quot;The ID of the item to get&quot;</span></span>), q: <span class="hljs-built_in">str</span></span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<h2 id="数值校验"><a href="#数值校验" class="headerlink" title="数值校验"></a>数值校验</h2><p>使用 Query 和 Path（以及你将在后面看到的其他类）可以声明字符串约束，但也可以声明数值约束。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    *, item_id: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">title=<span class="hljs-string">&quot;The ID of the item to get&quot;</span>, ge=<span class="hljs-number">1</span></span>), q: <span class="hljs-built_in">str</span></span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<ul>
<li>gt：大于（<code>g</code>reater <code>t</code>han）</li>
<li>ge：大于等于（<code>g</code>reater than or <code>e</code>qual）</li>
<li>lt：小于（<code>l</code>ess <code>t</code>han）</li>
<li>le：小于等于（<code>l</code>ess than or <code>e</code>qual）</li>
</ul>
<h1 id="请求体-多个参数"><a href="#请求体-多个参数" class="headerlink" title="请求体 - 多个参数"></a>请求体 - 多个参数</h1><h2 id="混合使用-Path、Query-和请求体参数"><a href="#混合使用-Path、Query-和请求体参数" class="headerlink" title="混合使用 Path、Query 和请求体参数"></a>混合使用 Path、Query 和请求体参数</h2><p>首先，毫无疑问地，你可以随意地混合使用 Path、Query 和请求体参数声明，FastAPI 会知道该如何处理。<br>你还可以通过将默认值设置为 None 来将请求体参数声明为可选参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params"></span><br><span class="hljs-params">    item_id: Annotated[<span class="hljs-built_in">int</span>, Path(<span class="hljs-params">title=<span class="hljs-string">&quot;The ID of the item to get&quot;</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">1000</span></span>)],</span><br><span class="hljs-params">    q: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">    item: Item | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params"></span>):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>

<p>路径操作将期望一个具有 Item 的属性的 JSON 请求体，就像：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="多个请求体参数"><a href="#多个请求体参数" class="headerlink" title="多个请求体参数"></a>多个请求体参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, item: Item, user: User</span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;item&quot;</span>: item, <span class="hljs-string">&quot;user&quot;</span>: user&#125;<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<p>在这种情况下，FastAPI 将注意到该函数中有多个请求体参数（两个 Pydantic 模型参数）。<br>因此，它将使用参数名称作为请求体中的键（字段名称），并期望一个类似于以下内容的请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;user&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dave&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;full_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dave Grohl&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="请求体中的单一值"><a href="#请求体中的单一值" class="headerlink" title="请求体中的单一值"></a>请求体中的单一值</h2><p>与使用 Query 和 Path 为查询参数和路径参数定义额外数据的方式相同，FastAPI 提供了一个同等的 Body。</p>
<p>例如，为了扩展先前的模型，你可能决定除了 item 和 user 之外，还想在同一请求体中具有另一个键 importance。</p>
<p>如果你就按原样声明它，因为它是一个单一值，FastAPI 将假定它是一个查询参数。</p>
<p>但是你可以使用 Body 指示 FastAPI 将其作为请求体的另一个键进行处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Body, FastAPI<br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params"></span><br><span class="hljs-params">    item_id: <span class="hljs-built_in">int</span>, item: Item, user: User, importance: Annotated[<span class="hljs-built_in">int</span>, Body(<span class="hljs-params"></span>)]</span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;item&quot;</span>: item, <span class="hljs-string">&quot;user&quot;</span>: user, <span class="hljs-string">&quot;importance&quot;</span>: importance&#125;<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>
<p>在这种情况下，FastAPI 将期望像这样的请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;user&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dave&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;full_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Dave Grohl&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;importance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="多个请求体参数和查询参数"><a href="#多个请求体参数和查询参数" class="headerlink" title="多个请求体参数和查询参数"></a>多个请求体参数和查询参数</h2><p>当然，除了请求体参数外，你还可以在任何需要的时候声明额外的查询参数。<br>由于默认情况下单一值被解释为查询参数，因此你不必显式地添加 Query，你可以仅执行以下操作：<br><code>q: str = None</code></p>
<h2 id="嵌入单个请求体参数"><a href="#嵌入单个请求体参数" class="headerlink" title="嵌入单个请求体参数"></a>嵌入单个请求体参数</h2><p>假设你只有一个来自 Pydantic 模型 Item 的请求体参数 item。<br>默认情况下，FastAPI 将直接期望这样的请求体。<br>但是，如果你希望它期望一个拥有 item 键并在值中包含模型内容的 JSON，就像在声明额外的请求体参数时所做的那样，则可以使用一个特殊的 Body 参数 embed：<br><code>item: Item = Body(embed=True)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, item: Annotated[Item, Body(<span class="hljs-params">embed=<span class="hljs-literal">True</span></span>)]</span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;item&quot;</span>: item&#125;<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>
<p>在这种情况下，FastAPI 将期望像这样的请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;item&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h1 id="请求体-字段"><a href="#请求体-字段" class="headerlink" title="请求体 - 字段"></a>请求体 - 字段</h1><p>与使用 Query、Path 和 Body 在路径操作函数中声明额外的校验和元数据的方式相同，你可以使用 Pydantic 的 Field 在 Pydantic 模型内部声明校验和元数据。</p>
<p>Field 的工作方式和 Query、Path 和 Body 相同，包括它们的参数等等也完全相同。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = Field(<br>        default=<span class="hljs-literal">None</span>, title=<span class="hljs-string">&quot;The description of the item&quot;</span>, max_length=<span class="hljs-number">300</span><br>    )<br>    price: <span class="hljs-built_in">float</span> = Field(gt=<span class="hljs-number">0</span>, description=<span class="hljs-string">&quot;The price must be greater than zero&quot;</span>)<br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure>

<h1 id="请求体-嵌套模型"><a href="#请求体-嵌套模型" class="headerlink" title="请求体 - 嵌套模型"></a>请求体 - 嵌套模型</h1><p>使用 FastAPI，你可以定义、校验、记录文档并使用任意深度嵌套的模型（归功于Pydantic）。</p>
<h2 id="List-字段"><a href="#List-字段" class="headerlink" title="List 字段"></a>List 字段</h2><p>你可以将一个属性定义为拥有子元素的类型。例如 Python list：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    tags: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>] = []<br></code></pre></td></tr></table></figure>

<h2 id="Set-字段"><a href="#Set-字段" class="headerlink" title="Set 字段"></a>Set 字段</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">tags: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()<br></code></pre></td></tr></table></figure>

<h2 id="嵌套模型"><a href="#嵌套模型" class="headerlink" title="嵌套模型"></a>嵌套模型</h2><p>我们可以定义一个 <code>Image</code> 模型：<br>然后我们可以将其用作一个属性的类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    url: <span class="hljs-built_in">str</span><br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    tags: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()<br>    image: Image | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, item: Item</span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;item&quot;</span>: item&#125;<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure>

<p>这意味着 FastAPI 将期望类似于以下内容的请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;rock&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;metal&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;bar&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://example.com/baz.jpg&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The Foo live&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="特殊的类型和校验"><a href="#特殊的类型和校验" class="headerlink" title="特殊的类型和校验"></a>特殊的类型和校验</h2><p>除了普通的单一值类型（如 str、int、float 等）外，你还可以使用从 str 继承的更复杂的单一值类型。<br>要了解所有的可用选项，请查看关于 <a target="_blank" rel="noopener" href="https://pydantic-docs.helpmanual.io/usage/types/">来自 Pydantic 的外部类型 的文档</a>。</p>
<p>例如，在 Image 模型中我们有一个 url 字段，我们可以把它声明为 Pydantic 的 HttpUrl，而不是 str：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, HttpUrl<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    url: HttpUrl<br>    name: <span class="hljs-built_in">str</span><br></code></pre></td></tr></table></figure>

<h2 id="带有一组子模型的属性"><a href="#带有一组子模型的属性" class="headerlink" title="带有一组子模型的属性"></a>带有一组子模型的属性</h2><p>你还可以将 Pydantic 模型用作 list、set 等的子类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    tags: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()<br>    images: <span class="hljs-built_in">list</span>[Image] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure>

<h2 id="深度嵌套模型"><a href="#深度嵌套模型" class="headerlink" title="深度嵌套模型"></a>深度嵌套模型</h2><p>你可以定义任意深度的嵌套模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    url: HttpUrl<br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    tags: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()<br>    images: <span class="hljs-built_in">list</span>[Image] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Offer</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    items: <span class="hljs-built_in">list</span>[Item]<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/offers/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_offer</span>(<span class="hljs-params">offer: Offer</span>):<br>    <span class="hljs-keyword">return</span> offer<br></code></pre></td></tr></table></figure>

<h2 id="纯列表请求体"><a href="#纯列表请求体" class="headerlink" title="纯列表请求体"></a>纯列表请求体</h2><p>如果你期望的 JSON 请求体的最外层是一个 JSON array（即 Python list），则可以在路径操作函数的参数中声明此类型，就像声明 Pydantic 模型一样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    url: HttpUrl<br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/images/multiple/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_multiple_images</span>(<span class="hljs-params">images: <span class="hljs-built_in">list</span>[Image]</span>):<br>    <span class="hljs-keyword">return</span> images<br></code></pre></td></tr></table></figure>

<h2 id="任意-dict-构成的请求体"><a href="#任意-dict-构成的请求体" class="headerlink" title="任意 dict 构成的请求体"></a>任意 dict 构成的请求体</h2><p>你也可以将请求体声明为使用某类型的键和其他类型值的 dict。<br>无需事先知道有效的字段&#x2F;属性（在使用 Pydantic 模型的场景）名称是什么。</p>
<p>在下面的例子中，你将接受任意键为 int 类型并且值为 float 类型的 dict：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/index-weights/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_index_weights</span>(<span class="hljs-params">weights: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">float</span>]</span>):<br>    <span class="hljs-keyword">return</span> weights<br></code></pre></td></tr></table></figure>

<div class="note warning flat"><p>请记住 JSON 仅支持将 str 作为键。<br>但是 Pydantic 具有自动转换数据的功能。<br>这意味着，即使你的 API 客户端只能将字符串作为键发送，只要这些字符串内容仅包含整数，Pydantic 就会对其进行转换并校验。<br>然后你接收的名为 weights 的 dict 实际上将具有 int 类型的键和 float 类型的值。</p>
</div>

<h1 id="模式的额外信息-例子"><a href="#模式的额外信息-例子" class="headerlink" title="模式的额外信息 - 例子"></a>模式的额外信息 - 例子</h1><p>您可以在JSON模式中定义额外的信息。<br>一个常见的用例是添加一个将在文档中显示的example。<br>有几种方法可以声明额外的 JSON 模式信息。</p>
<h1 id="其他数据类型"><a href="#其他数据类型" class="headerlink" title="其他数据类型"></a>其他数据类型</h1><p>到目前为止，您一直在使用常见的数据类型，如:</p>
<ul>
<li>int</li>
<li>float</li>
<li>str</li>
<li>bool</li>
</ul>
<p>但是您也可以使用更复杂的数据类型。</p>
<ul>
<li>UUID:<ul>
<li>一种标准的 “通用唯一标识符” ，在许多数据库和系统中用作ID。</li>
<li>在请求和响应中将以 str 表示。</li>
</ul>
</li>
<li>datetime.datetime:<ul>
<li>一个 Python datetime.datetime.</li>
<li>在请求和响应中将表示为 ISO 8601 格式的 str ，比如: 2008-09-15T15:53:00+05:00.</li>
</ul>
</li>
<li>datetime.date:<ul>
<li>Python datetime.date.</li>
<li>在请求和响应中将表示为 ISO 8601 格式的 str ，比如: 2008-09-15.</li>
</ul>
</li>
<li>datetime.time:<ul>
<li>一个 Python datetime.time.</li>
<li>在请求和响应中将表示为 ISO 8601 格式的 str ，比如: 14:23:55.003.</li>
</ul>
</li>
<li>datetime.timedelta:<ul>
<li>一个 Python datetime.timedelta.</li>
<li>在请求和响应中将表示为 float 代表总秒数。</li>
<li>Pydantic 也允许将其表示为 “ISO 8601 时间差异编码”, 查看文档了解更多信息。</li>
</ul>
</li>
<li>frozenset:<ul>
<li>在请求和响应中，作为 set 对待：</li>
<li>在请求中，列表将被读取，消除重复，并将其转换为一个 set。</li>
<li>在响应中 set 将被转换为 list 。</li>
<li>产生的模式将指定那些 set 的值是唯一的 (使用 JSON 模式的 uniqueItems)。</li>
</ul>
</li>
<li>bytes:<br>标准的 Python bytes。<ul>
<li>在请求和相应中被当作 str 处理。</li>
<li>生成的模式将指定这个 str 是 binary “格式”。</li>
</ul>
</li>
<li>Decimal:<ul>
<li>标准的 Python Decimal。</li>
<li>在请求和相应中被当做 float 一样处理。</li>
<li>您可以在这里检查所有有效的pydantic数据类型: <a target="_blank" rel="noopener" href="https://pydantic-docs.helpmanual.io/usage/types">Pydantic data types</a>.</li>
</ul>
</li>
</ul>
<h1 id="Cookie-参数"><a href="#Cookie-参数" class="headerlink" title="Cookie 参数"></a>Cookie 参数</h1><p>你可以像定义 Query 参数和 Path 参数一样来定义 Cookie 参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Cookie, FastAPI<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">ads_id: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Cookie(<span class="hljs-params"></span>)] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;ads_id&quot;</span>: ads_id&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Header-参数"><a href="#Header-参数" class="headerlink" title="Header 参数"></a>Header 参数</h1><p>你可以使用定义 Query, Path 和 Cookie 参数一样的方法定义 Header 参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Header<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">user_agent: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Header(<span class="hljs-params"></span>)] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: user_agent&#125;<br></code></pre></td></tr></table></figure>

<h2 id="自动转换"><a href="#自动转换" class="headerlink" title="自动转换"></a>自动转换</h2><p>Header 在 Path, Query 和 Cookie 提供的功能之上有一点额外的功能。<br>大多数标准的headers用 “连字符” 分隔，也称为 “减号” (-)。<br>但是像 user-agent 这样的变量在Python中是无效的。</p>
<p>因此, 默认情况下, Header 将把参数名称的字符从下划线 (_) 转换为连字符 (-) 来提取并记录 headers.<br>同时，HTTP headers 是大小写不敏感的，因此，因此可以使用标准Python样式(也称为 “snake_case”)声明它们。</p>
<p>因此，您可以像通常在Python代码中那样使用 user_agent ，而不需要将首字母大写为 User_Agent 或类似的东西。<br>如果出于某些原因，你需要禁用下划线到连字符的自动转换，设置Header的参数 convert_underscores 为 False:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    strange_header: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Header(<span class="hljs-params">convert_underscores=<span class="hljs-literal">False</span></span>)] = <span class="hljs-literal">None</span></span><br><span class="hljs-params"></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;strange_header&quot;</span>: strange_header&#125;<br></code></pre></td></tr></table></figure>

<h2 id="重复的-headers"><a href="#重复的-headers" class="headerlink" title="重复的 headers"></a>重复的 headers</h2><p>有可能收到重复的headers。这意味着，相同的header具有多个值。<br>您可以在类型声明中使用一个list来定义这些情况。<br>你可以通过一个Python list 的形式获得重复header的所有值。</p>
<p>比如, 为了声明一个 X-Token header 可以出现多次，你可以这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">x_token: Annotated[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>] | <span class="hljs-literal">None</span>, Header(<span class="hljs-params"></span>)] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;X-Token values&quot;</span>: x_token&#125;<br></code></pre></td></tr></table></figure>

<h1 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h1><h2 id="响应模型"><a href="#响应模型" class="headerlink" title="响应模型"></a>响应模型</h2><p>你可以在任意的路径操作中使用 response_model 参数来声明用于响应的模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span>, response_model=Item</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>) -&gt; <span class="hljs-type">Any</span>:<br>    <span class="hljs-keyword">return</span> item<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span>, response_model=<span class="hljs-built_in">list</span>[Item]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>() -&gt; <span class="hljs-type">Any</span>:<br>    <span class="hljs-keyword">return</span> [<br>        &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Portal Gun&quot;</span>, <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-number">42.0</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Plumbus&quot;</span>, <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-number">32.0</span>&#125;,<br>    ]<br></code></pre></td></tr></table></figure>
<p>FastAPI 将使用此 response_model 来：</p>
<ul>
<li>将输出数据转换为其声明的类型。</li>
<li>校验数据。</li>
<li>在 OpenAPI 的路径操作中为响应添加一个 JSON Schema。</li>
<li>并在自动生成文档系统中使用。</li>
</ul>
<p>但最重要的是：</p>
<ul>
<li>会将输出数据限制在该模型定义内。下面我们会看到这一点有多重要。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserIn</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br>    email: EmailStr<br>    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserOut</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    email: EmailStr<br>    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># FastAPI 将会负责过滤掉未在输出模型中声明的所有数据（使用 Pydantic）。</span><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user/&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserIn</span>) -&gt; <span class="hljs-type">Any</span>:<br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure>

<h2 id="响应模型编码参数"><a href="#响应模型编码参数" class="headerlink" title="响应模型编码参数"></a>响应模型编码参数</h2><p>你的响应模型可以具有默认值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> = <span class="hljs-number">10.5</span><br>    tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = []<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item, response_model_exclude_unset=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> items[item_id]<br></code></pre></td></tr></table></figure>
<p><code>response_model_exclude_unset=True</code> 表明响应中将不会包含那些默认值，而是仅有实际设置的值。</p>
<p>你还可以使用：</p>
<ul>
<li>response_model_exclude_defaults&#x3D;True</li>
<li>response_model_exclude_none&#x3D;True</li>
</ul>
<p>response_model_include 和 response_model_exclude<br>你还可以使用路径操作装饰器的 response_model_include 和 response_model_exclude 参数。</p>
<p>它们接收一个由属性名称 str 组成的 set 来包含（忽略其他的）或者排除（包含其他的）这些属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-meta">    <span class="hljs-string">&quot;/items/&#123;item_id&#125;/name&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model=Item,</span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model_include=&#123;<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>&#125;,</span></span><br><span class="hljs-params"><span class="hljs-meta"></span>)</span><br></code></pre></td></tr></table></figure>

<h2 id="额外的模型"><a href="#额外的模型" class="headerlink" title="额外的模型"></a>额外的模型</h2><h3 id="多个模型"><a href="#多个模型" class="headerlink" title="多个模型"></a>多个模型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, EmailStr<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBase</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    email: EmailStr<br>    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserIn</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserOut</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInDB</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    hashed_password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fake_password_hasher</span>(<span class="hljs-params">raw_password: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;supersecret&quot;</span> + raw_password<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fake_save_user</span>(<span class="hljs-params">user_in: UserIn</span>):<br>    hashed_password = fake_password_hasher(user_in.password)<br>    user_in_db = UserInDB(**user_in.<span class="hljs-built_in">dict</span>(), hashed_password=hashed_password)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;User saved! ..not really&quot;</span>)<br>    <span class="hljs-keyword">return</span> user_in_db<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user/&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user_in: UserIn</span>):<br>    user_saved = fake_save_user(user_in)<br>    <span class="hljs-keyword">return</span> user_saved<br><br></code></pre></td></tr></table></figure>

<h3 id="多个响应声明"><a href="#多个响应声明" class="headerlink" title="多个响应声明"></a>多个响应声明</h3><p>你可以将一个响应声明为两种类型的 Union，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=<span class="hljs-type">Union</span>[PlaneItem, CarItem]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> items[item_id]<br></code></pre></td></tr></table></figure>

<h3 id="模型列表"><a href="#模型列表" class="headerlink" title="模型列表"></a>模型列表</h3><p>你可以用同样的方式声明由对象列表构成的响应。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span>, response_model=<span class="hljs-built_in">list</span>[Item]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>():<br>    <span class="hljs-keyword">return</span> items<br></code></pre></td></tr></table></figure>

<h3 id="任意-dict-构成的响应"><a href="#任意-dict-构成的响应" class="headerlink" title="任意 dict 构成的响应"></a>任意 dict 构成的响应</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/keyword-weights/&quot;</span>, response_model=<span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">float</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_keyword_weights</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;foo&quot;</span>: <span class="hljs-number">2.3</span>, <span class="hljs-string">&quot;bar&quot;</span>: <span class="hljs-number">3.4</span>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, status<br><br><span class="hljs-comment"># 或者直接写 201</span><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span>, status_code=status.HTTP_201_CREATED</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;name&quot;</span>: name&#125;<br></code></pre></td></tr></table></figure>

<h1 id="表单数据"><a href="#表单数据" class="headerlink" title="表单数据"></a>表单数据</h1><p>接收的不是 JSON，而是表单字段时，要使用 Form。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form<br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;username&quot;</span>: username&#125;<br></code></pre></td></tr></table></figure>

<h1 id="请求文件"><a href="#请求文件" class="headerlink" title="请求文件"></a>请求文件</h1><ul>
<li>定义 File 参数</li>
<li>含 UploadFile 的文件参数</li>
</ul>
<p>UploadFile 与 bytes 相比有更多优势：</p>
<ul>
<li>使用 spooled 文件：<ul>
<li>存储在内存的文件超出最大上限时，FastAPI 会把文件存入磁盘；</li>
</ul>
</li>
<li>这种方式更适于处理图像、视频、二进制文件等大型文件，好处是不会占用所有内存；</li>
<li>可获取上传文件的元数据；</li>
<li>自带 file-like async 接口；</li>
<li>暴露的 Python SpooledTemporaryFile 对象，可直接传递给其他预期「file-like」对象的库。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/files/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_file</span>(<span class="hljs-params">file: <span class="hljs-built_in">bytes</span> = File(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;file_size&quot;</span>: <span class="hljs-built_in">len</span>(file)&#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/uploadfile/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_upload_file</span>(<span class="hljs-params">file: UploadFile</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;filename&quot;</span>: file.filename&#125;<br></code></pre></td></tr></table></figure>

<h1 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h1><h2 id="使用-HTTPException"><a href="#使用-HTTPException" class="headerlink" title="使用 HTTPException"></a>使用 HTTPException</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">if</span> item_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> items:<br>        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">&quot;Item not found&quot;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item&quot;</span>: items[item_id]&#125;<br></code></pre></td></tr></table></figure>

<h2 id="添加自定义响应头"><a href="#添加自定义响应头" class="headerlink" title="添加自定义响应头"></a>添加自定义响应头</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items-header/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item_header</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">if</span> item_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> items:<br>        <span class="hljs-keyword">raise</span> HTTPException(<br>            status_code=<span class="hljs-number">404</span>,<br>            detail=<span class="hljs-string">&quot;Item not found&quot;</span>,<br>            headers=&#123;<span class="hljs-string">&quot;X-Error&quot;</span>: <span class="hljs-string">&quot;There goes my error&quot;</span>&#125;,<br>        )<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item&quot;</span>: items[item_id]&#125;<br></code></pre></td></tr></table></figure>

<h2 id="安装自定义异常处理器"><a href="#安装自定义异常处理器" class="headerlink" title="安装自定义异常处理器"></a>安装自定义异常处理器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UnicornException</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span></span>):<br>        self.name = name<br><br><span class="hljs-meta">@app.exception_handler(<span class="hljs-params">UnicornException</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">unicorn_exception_handler</span>(<span class="hljs-params">request: Request, exc: UnicornException</span>):<br>    <span class="hljs-keyword">return</span> JSONResponse(<br>        status_code=<span class="hljs-number">418</span>,<br>        content=&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Oops! <span class="hljs-subst">&#123;exc.name&#125;</span> did something. There goes a rainbow...&quot;</span>&#125;,<br>    )<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/unicorns/&#123;name&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_unicorn</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">if</span> name == <span class="hljs-string">&quot;yolo&quot;</span>:<br>        <span class="hljs-keyword">raise</span> UnicornException(name=name)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;unicorn_name&quot;</span>: name&#125;<br></code></pre></td></tr></table></figure>

<h2 id="覆盖默认异常处理器"><a href="#覆盖默认异常处理器" class="headerlink" title="覆盖默认异常处理器"></a>覆盖默认异常处理器</h2><p>FastAPI 自带了一些默认异常处理器。<br>触发 HTTPException 或请求无效数据时，这些处理器返回默认的 JSON 响应结果。<br>不过，也可以使用自定义处理器覆盖默认异常处理器</p>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><p>……</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://dak.wang">大可</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://dak.wang/python/fastapi/guide/">https://dak.wang/python/fastapi/guide/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dak.wang" target="_blank">大可墨韵</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/">学习之旅</a><a class="post-meta__tags" href="/tags/Python%E6%A1%86%E6%9E%B6/">Python框架</a><a class="post-meta__tags" href="/tags/API%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91/">API接口开发</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/assets/imgs/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/assets/imgs/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/hexo/help/" title="Hexo的使用帮助"><img class="cover" src="/hexo/help/cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hexo的使用帮助</div></div></a></div><div class="next-post pull-right"><a href="/python/fastapi/install/" title="FastAPI - 安装和运行"><img class="cover" src="/python/fastapi/install/cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">FastAPI - 安装和运行</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/python/fastapi/install/" title="FastAPI - 安装和运行"><img class="cover" src="/python/fastapi/install/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">FastAPI - 安装和运行</div></div></a></div><div><a href="/ai/stablediffusion/1/" title="Stable Diffusion - (一)安装和运行"><img class="cover" src="/ai/stablediffusion/1/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-23</div><div class="title">Stable Diffusion - (一)安装和运行</div></div></a></div><div><a href="/ai/stablediffusion/2/" title="Stable Diffusion - (二)绘画原理与软件基础"><img class="cover" src="/ai/stablediffusion/2/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-23</div><div class="title">Stable Diffusion - (二)绘画原理与软件基础</div></div></a></div><div><a href="/ai/stablediffusion/3/" title="Stable Diffusion - (三)文生图入门与参数设置"><img class="cover" src="/ai/stablediffusion/3/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-24</div><div class="title">Stable Diffusion - (三)文生图入门与参数设置</div></div></a></div><div><a href="/ai/stablediffusion/4/" title="Stable Diffusion - (四)图生图入门"><img class="cover" src="/ai/stablediffusion/4/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-24</div><div class="title">Stable Diffusion - (四)图生图入门</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/imgs/dak_avatar_120.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">大可</div><div class="author-info__description">大可墨韵，记录学习之旅的点点滴滴。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客，若喜欢请收藏 ^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">路径参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">有类型的路径参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E5%BE%88%E9%87%8D%E8%A6%81"><span class="toc-number">1.2.</span> <span class="toc-text">顺序很重要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E8%AE%BE%E5%80%BC"><span class="toc-number">1.3.</span> <span class="toc-text">预设值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-Enum-%E7%B1%BB"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建一个 Enum 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">声明路径参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E8%B7%AF%E5%BE%84%E7%9A%84%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">包含路径的路径参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">查询参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">2.1.</span> <span class="toc-text">默认值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">可选参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.3.</span> <span class="toc-text">查询参数类型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%B7%AF%E5%BE%84%E5%92%8C%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">多个路径和查询参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%85%E9%9C%80%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">必需查询参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-number">3.</span> <span class="toc-text">请求体</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-Pydantic-%E7%9A%84-BaseModel"><span class="toc-number">3.1.</span> <span class="toc-text">导入 Pydantic 的 BaseModel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">创建数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E4%B8%BA%E5%8F%82%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text">声明为参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">3.4.</span> <span class="toc-text">结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.5.</span> <span class="toc-text">使用模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.6.</span> <span class="toc-text">请求体 + 路径参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0-%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">3.7.</span> <span class="toc-text">请求体 + 路径参数 + 查询参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8-Pydantic"><span class="toc-number">3.8.</span> <span class="toc-text">不使用 Pydantic</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.</span> <span class="toc-text">查询参数和字符串校验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.1.</span> <span class="toc-text">额外的校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%A4%9A%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.2.</span> <span class="toc-text">添加更多校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC-1"><span class="toc-number">4.3.</span> <span class="toc-text">默认值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E4%B8%BA%E5%BF%85%E9%9C%80%E5%8F%82%E6%95%B0"><span class="toc-number">4.4.</span> <span class="toc-text">声明为必需参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%9C%81%E7%95%A5%E5%8F%B7-%E2%80%A6-%E5%A3%B0%E6%98%8E%E5%BF%85%E9%9C%80%E5%8F%82%E6%95%B0"><span class="toc-number">4.4.1.</span> <span class="toc-text">使用省略号(…)声明必需参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8None%E5%A3%B0%E6%98%8E%E5%BF%85%E9%9C%80%E5%8F%82%E6%95%B0"><span class="toc-number">4.4.2.</span> <span class="toc-text">使用None声明必需参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Pydantic%E4%B8%AD%E7%9A%84Required%E4%BB%A3%E6%9B%BF%E7%9C%81%E7%95%A5%E5%8F%B7-%E2%80%A6"><span class="toc-number">4.4.3.</span> <span class="toc-text">使用Pydantic中的Required代替省略号(…)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8-%E5%A4%9A%E4%B8%AA%E5%80%BC"><span class="toc-number">4.5.</span> <span class="toc-text">查询参数列表 &#x2F; 多个值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E9%BB%98%E8%AE%A4%E5%80%BC%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8-%E5%A4%9A%E4%B8%AA%E5%80%BC"><span class="toc-number">4.5.1.</span> <span class="toc-text">具有默认值的查询参数列表 &#x2F; 多个值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-list"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">使用 list</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E6%9B%B4%E5%A4%9A%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">4.6.</span> <span class="toc-text">声明更多元数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E5%8F%82%E6%95%B0"><span class="toc-number">4.7.</span> <span class="toc-text">别名参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%83%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">4.8.</span> <span class="toc-text">弃用参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0%E5%92%8C%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C"><span class="toc-number">5.</span> <span class="toc-text">路径参数和数值校验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">声明元数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%AF%B9%E5%8F%82%E6%95%B0%E6%8E%92%E5%BA%8F"><span class="toc-number">5.2.</span> <span class="toc-text">按需对参数排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E6%A0%A1%E9%AA%8C"><span class="toc-number">5.3.</span> <span class="toc-text">数值校验</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">请求体 - 多个参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8-Path%E3%80%81Query-%E5%92%8C%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-number">6.1.</span> <span class="toc-text">混合使用 Path、Query 和请求体参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">多个请求体参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93%E4%B8%AD%E7%9A%84%E5%8D%95%E4%B8%80%E5%80%BC"><span class="toc-number">6.3.</span> <span class="toc-text">请求体中的单一值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0%E5%92%8C%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">6.4.</span> <span class="toc-text">多个请求体参数和查询参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%8D%95%E4%B8%AA%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-number">6.5.</span> <span class="toc-text">嵌入单个请求体参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E5%AD%97%E6%AE%B5"><span class="toc-number">7.</span> <span class="toc-text">请求体 - 字段</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93-%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.</span> <span class="toc-text">请求体 - 嵌套模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#List-%E5%AD%97%E6%AE%B5"><span class="toc-number">8.1.</span> <span class="toc-text">List 字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set-%E5%AD%97%E6%AE%B5"><span class="toc-number">8.2.</span> <span class="toc-text">Set 字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.3.</span> <span class="toc-text">嵌套模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%A0%A1%E9%AA%8C"><span class="toc-number">8.4.</span> <span class="toc-text">特殊的类型和校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E4%B8%80%E7%BB%84%E5%AD%90%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">8.5.</span> <span class="toc-text">带有一组子模型的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E5%B5%8C%E5%A5%97%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.6.</span> <span class="toc-text">深度嵌套模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF%E5%88%97%E8%A1%A8%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-number">8.7.</span> <span class="toc-text">纯列表请求体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F-dict-%E6%9E%84%E6%88%90%E7%9A%84%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-number">8.8.</span> <span class="toc-text">任意 dict 构成的请求体</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%A2%9D%E5%A4%96%E4%BF%A1%E6%81%AF-%E4%BE%8B%E5%AD%90"><span class="toc-number">9.</span> <span class="toc-text">模式的额外信息 - 例子</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.</span> <span class="toc-text">其他数据类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cookie-%E5%8F%82%E6%95%B0"><span class="toc-number">11.</span> <span class="toc-text">Cookie 参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Header-%E5%8F%82%E6%95%B0"><span class="toc-number">12.</span> <span class="toc-text">Header 参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2"><span class="toc-number">12.1.</span> <span class="toc-text">自动转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E7%9A%84-headers"><span class="toc-number">12.2.</span> <span class="toc-text">重复的 headers</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-number">13.</span> <span class="toc-text">响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B"><span class="toc-number">13.1.</span> <span class="toc-text">响应模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B%E7%BC%96%E7%A0%81%E5%8F%82%E6%95%B0"><span class="toc-number">13.2.</span> <span class="toc-text">响应模型编码参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E6%A8%A1%E5%9E%8B"><span class="toc-number">13.3.</span> <span class="toc-text">额外的模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9E%8B"><span class="toc-number">13.3.1.</span> <span class="toc-text">多个模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%93%8D%E5%BA%94%E5%A3%B0%E6%98%8E"><span class="toc-number">13.3.2.</span> <span class="toc-text">多个响应声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%88%97%E8%A1%A8"><span class="toc-number">13.3.3.</span> <span class="toc-text">模型列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F-dict-%E6%9E%84%E6%88%90%E7%9A%84%E5%93%8D%E5%BA%94"><span class="toc-number">13.3.4.</span> <span class="toc-text">任意 dict 构成的响应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">13.4.</span> <span class="toc-text">响应状态码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">14.</span> <span class="toc-text">表单数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6"><span class="toc-number">15.</span> <span class="toc-text">请求文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-number">16.</span> <span class="toc-text">处理错误</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-HTTPException"><span class="toc-number">16.1.</span> <span class="toc-text">使用 HTTPException</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">16.2.</span> <span class="toc-text">添加自定义响应头</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">16.3.</span> <span class="toc-text">安装自定义异常处理器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">16.4.</span> <span class="toc-text">覆盖默认异常处理器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TODO"><span class="toc-number">17.</span> <span class="toc-text">TODO</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/ai/stablediffusion/4/" title="Stable Diffusion - (四)图生图入门"><img src="/ai/stablediffusion/4/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Stable Diffusion - (四)图生图入门"/></a><div class="content"><a class="title" href="/ai/stablediffusion/4/" title="Stable Diffusion - (四)图生图入门">Stable Diffusion - (四)图生图入门</a><time datetime="2023-08-24T07:30:17.000Z" title="发表于 2023-08-24 15:30:17">2023-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ai/stablediffusion/3/" title="Stable Diffusion - (三)文生图入门与参数设置"><img src="/ai/stablediffusion/3/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Stable Diffusion - (三)文生图入门与参数设置"/></a><div class="content"><a class="title" href="/ai/stablediffusion/3/" title="Stable Diffusion - (三)文生图入门与参数设置">Stable Diffusion - (三)文生图入门与参数设置</a><time datetime="2023-08-24T04:30:17.000Z" title="发表于 2023-08-24 12:30:17">2023-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ai/stablediffusion/2/" title="Stable Diffusion - (二)绘画原理与软件基础"><img src="/ai/stablediffusion/2/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Stable Diffusion - (二)绘画原理与软件基础"/></a><div class="content"><a class="title" href="/ai/stablediffusion/2/" title="Stable Diffusion - (二)绘画原理与软件基础">Stable Diffusion - (二)绘画原理与软件基础</a><time datetime="2023-08-23T04:30:17.000Z" title="发表于 2023-08-23 12:30:17">2023-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ai/stablediffusion/1/" title="Stable Diffusion - (一)安装和运行"><img src="/ai/stablediffusion/1/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Stable Diffusion - (一)安装和运行"/></a><div class="content"><a class="title" href="/ai/stablediffusion/1/" title="Stable Diffusion - (一)安装和运行">Stable Diffusion - (一)安装和运行</a><time datetime="2023-08-23T03:30:17.000Z" title="发表于 2023-08-23 11:30:17">2023-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/hexo/help/" title="Hexo的使用帮助"><img src="/hexo/help/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo的使用帮助"/></a><div class="content"><a class="title" href="/hexo/help/" title="Hexo的使用帮助">Hexo的使用帮助</a><time datetime="2023-08-10T09:26:08.000Z" title="发表于 2023-08-10 17:26:08">2023-08-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/python/fastapi/guide/cover.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By 大可</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline.dak.wang',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, {"reaction":["http://unpkg.com/@waline/emojis/tieba/tieba_agree.png","http://unpkg.com/@waline/emojis/tieba/tieba_look_down.png"],"dark":false,"meta":["nick","mail"],"copyright":false}))
  }

  if (typeof Waline === 'object') initWaline()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css').then(() => {
      getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
    })
  }
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://waline.dak.wang/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="26467411" data-server="netease" data-type="playlist" data-autoplay="true" data-order="random" data-fixed="true"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="150" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>